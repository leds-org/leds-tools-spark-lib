name: PR Checks

on:
  pull_request:
    branches:
      - develop

jobs:
  verify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20.x'

      - name: Instalar dependÃªncias
        run: npm ci

      - name: Executar testes
        run: npm run test

      - name: AnÃ¡lise com SonarCloud
        uses: SonarSource/sonarcloud-github-action@v2
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      - name: Enviar email de notificaÃ§Ã£o
        if: success()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASS }}
          subject: "âœ… VerificaÃ§Ã£o concluÃ­da com sucesso - PR #${{ github.event.pull_request.number }}"
          body: |
            âœ… Todas as verificaÃ§Ãµes foram concluÃ­das com sucesso para o Pull Request #${{ github.event.pull_request.number }}.

            ğŸ”— Link do PR: ${{ github.event.pull_request.html_url }}
            ğŸ“ RepositÃ³rio: ${{ github.repository }}
            ğŸ” Branch: ${{ github.head_ref }}
            ğŸ™‹â€â™‚ï¸ Autor: ${{ github.event.pull_request.user.login }}
          to: caiochiabaioliveira@gmail.com
          from: "GitHub Actions <${{ secrets.EMAIL_USER }}>"    

      - name: Enviar email de falha
        if: failure()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASS }}
          subject: âŒ CI falhou - ${{ github.repository }}
          to: caiochiabaioliveira@gmail.com
          from: GitHub Actions <${{ secrets.EMAIL_USER }}>
          body: |

                <div style="font-family: sans-serif; padding: 16px;">
                <h2 style="color: #2e6da4;">âœ… PublicaÃ§Ã£o concluÃ­da com sucesso!</h2>
                <p><strong>ğŸ“ RepositÃ³rio:</strong> <a href="https://github.com/${{ github.repository }}">{{ github.repository }}</a></p>
                <p><strong>ğŸ”– VersÃ£o:</strong> v${{ steps.package_version.outputs.version }}</p>
                  <p><strong>ğŸ”— Commit:</strong> <a href="https://github.com/${{ github.repository }}/commit/${{ github.sha }}">
                    ${{ github.sha }}</a></p>
                  <p><strong>ğŸ“¦ NPM:</strong> <a href="https://www.npmjs.com/package/spark-generators-lib">
                    spark-generators-lib</a></p>

                  <hr style="margin-top: 24px;" />
                  <p style="font-size: 0.9em; color: #999;">Este e-mail foi enviado automaticamente pelo GitHub Actions.</p>
                </div>










            